<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è¯­åŠ©è¯å¤§é—¯å…³</title>
    <style>
        body {
            font-family: "Microsoft YaHei", "Hiragino Sans GB", sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }

        /* é¡¶éƒ¨æ  */
        .header {
            width: 100%;
            background: #fff;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: relative;
        }
        .header h2 { margin: 0; color: #2c3e50; font-size: 1.2rem; }
        .progress-text { font-size: 0.9rem; color: #666; margin-top: 5px; }

        /* ä¸»å®¹å™¨ */
        .container {
            width: 90%;
            max-width: 600px;
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px 0;
        }

        /* å…³å¡é€‰æ‹©èœå• */
        #level-menu {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
        }
        .level-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            border: 2px solid #e0e0e0;
            transition: 0.2s;
        }
        .level-card:hover { border-color: #3498db; transform: translateY(-3px); }
        .level-card.locked { opacity: 0.6; pointer-events: none; background: #eee; }
        .level-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 5px; }
        .level-desc { font-size: 0.8rem; color: #7f8c8d; }

        /* æ¸¸æˆåŒºåŸŸ */
        #game-area { display: none; width: 100%; flex-direction: column; align-items: center; }
        
        .scene-box {
            font-size: 4rem;
            margin-bottom: 10px;
            animation: bounce 2s infinite;
        }
        
        .sentence-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 100%;
            text-align: center;
            font-size: 1.4rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            position: relative;
            box-sizing: border-box;
        }
        
        .blank {
            display: inline-block;
            min-width: 50px;
            border-bottom: 3px solid #3498db;
            color: #3498db;
            padding: 0 5px;
            font-weight: bold;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
        }
        
        .option-btn {
            background: white;
            border: 2px solid #bdc3c7;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            font-family: "Microsoft YaHei", sans-serif;
            transition: 0.2s;
        }
        .option-btn:hover { background: #ecf0f1; }
        .option-btn.correct { background: #2ecc71; color: white; border-color: #27ae60; }
        .option-btn.wrong { background: #e74c3c; color: white; border-color: #c0392b; }

        /* è§£æå¼¹çª— */
        .feedback-panel {
            margin-top: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
            width: 100%;
            box-sizing: border-box;
            display: none;
            animation: fadeIn 0.3s;
        }
        .feedback-title { font-weight: bold; margin-bottom: 5px; display: block; }
        .feedback-content { font-size: 0.9rem; color: #555; }

        /* ç»“ç®—é¡µé¢ */
        #result-area { display: none; text-align: center; width: 100%; }
        .score-circle {
            width: 120px; height: 120px;
            border-radius: 50%;
            background: #3498db;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 20px;
        }
        
        .mistake-list {
            text-align: left;
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        .mistake-item { border-bottom: 1px solid #eee; padding: 10px 0; }
        .mistake-item:last-child { border-bottom: none; }

        .btn {
            background: #3498db; color: white; border: none;
            padding: 12px 30px; border-radius: 25px;
            font-size: 1rem; cursor: pointer; margin-top: 20px;
            font-family: "Microsoft YaHei", sans-serif;
        }
        .btn-outline { background: transparent; border: 2px solid #3498db; color: #3498db; }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="header">
        <h2 id="page-title">åŠ©è¯ç‰¹è®­è¥</h2>
        <div class="progress-text" id="progress-display">é€‰æ‹©å…³å¡å¼€å§‹æŒ‘æˆ˜</div>
    </div>

    <div class="container">
        <!-- 1. å…³å¡èœå• -->
        <div id="level-menu">
            <!-- JSç”Ÿæˆ -->
        </div>

        <!-- 2. æ¸¸æˆç•Œé¢ -->
        <div id="game-area">
            <div class="scene-box" id="scene-emoji">ğŸ«</div>
            <div class="sentence-box" id="sentence-display">
                <!-- é¢˜ç›®å†…å®¹ -->
            </div>
            
            <div class="options-grid" id="options-container">
                <!-- é€‰é¡¹æŒ‰é’® -->
            </div>

            <div class="feedback-panel" id="feedback-box">
                <span class="feedback-title" id="fb-title"></span>
                <span class="feedback-content" id="fb-desc"></span>
                <div style="text-align: right; margin-top: 10px;">
                    <button class="btn" style="padding: 5px 15px; font-size: 0.9rem;" onclick="nextQuestion()">ç»§ç»­</button>
                </div>
            </div>
        </div>

        <!-- 3. ç»“ç®—ç•Œé¢ -->
        <div id="result-area">
            <div class="score-circle" id="final-score">80%</div>
            <h3 id="result-msg">æŒ‘æˆ˜æˆåŠŸï¼</h3>
            
            <div class="mistake-list" id="mistake-box" style="display:none;">
                <h4 style="margin:0 0 10px 0; color:#e74c3c;">âŒ é”™é¢˜æœ¬ (è‡ªåŠ¨æ”¶é›†)</h4>
                <div id="mistake-items"></div>
            </div>

            <button class="btn" onclick="showMenu()">è¿”å›å…³å¡åˆ—è¡¨</button>
            <button class="btn btn-outline" onclick="retryLevel()">å†è¯•ä¸€æ¬¡</button>
        </div>
    </div>

<script>
    // === é¢˜åº“æ•°æ® ===
    const gameData = [
        {
            id: 1, title: "å…¥é—¨ï¼šã¯ / ãŒ / ã‚’", desc: "ä¸»è¯­ã€ä¸»é¢˜ä¸å®¾è¯­çš„åŸºç¡€åŒºåˆ†",
            questions: [
                { s: "ç§__å­¦ç”Ÿã§ã™ã€‚", ans: "ã¯", opts: ["ã¯", "ãŒ", "ã‚’"], tip: "ã€Œã¯ã€æç¤ºä¸»é¢˜ï¼Œè¡¨ç¤ºâ€œæˆ‘æ˜¯å­¦ç”Ÿâ€ã€‚", img: "ğŸ‘¨â€ğŸ“" },
                { s: "ã‚Šã‚“ã”__é£Ÿã¹ã¾ã™ã€‚", ans: "ã‚’", opts: ["ã¯", "ã«", "ã‚’"], tip: "ã€Œã‚’ã€è¡¨ç¤ºåŠ¨ä½œçš„å¯¹è±¡ï¼ˆå®¾è¯­ï¼‰ã€‚", img: "ğŸ" },
                { s: "çŒ«__ã„ã¾ã™ã€‚", ans: "ãŒ", opts: ["ã¯", "ã‚’", "ãŒ"], tip: "å­˜åœ¨å¥ä¸­ï¼Œå­˜åœ¨çš„ä¸»ä½“ç”¨ã€ŒãŒã€æç¤ºã€‚", img: "ğŸ±" },
                { s: "ã“ã‚Œ__æœ¬ã§ã™ã€‚", ans: "ã¯", opts: ["ã¯", "ã®", "ã‚’"], tip: "ã€Œã“ã‚Œã€æ˜¯ä¸»é¢˜ï¼Œåæ¥ã€Œã¯ã€ã€‚", img: "ğŸ“–" },
                { s: "ã”é£¯__ä½œã‚Šã¾ã™ã€‚", ans: "ã‚’", opts: ["ãŒ", "ã‚’", "ã¸"], tip: "åšé¥­ï¼Œé¥­æ˜¯åˆ¶ä½œçš„å¯¹è±¡ï¼Œç”¨ã€Œã‚’ã€ã€‚", img: "ğŸ³" }
            ]
        },
        {
            id: 2, title: "è¿›é˜¶ï¼šã« / ã§ / ã¸", desc: "æ—¶é—´ã€åœ°ç‚¹ä¸æ–¹å‘çš„æ˜“æ··ç‚¹",
            questions: [
                { s: "å­¦æ ¡__è¡Œãã¾ã™ã€‚", ans: "ã¸", opts: ["ã«", "ã§", "ã¸"], tip: "è¡¨ç¤ºç§»åŠ¨æ–¹å‘æ—¶ï¼Œå¸¸ç”¨ã€Œã¸ã€ï¼ˆè¯»ä½œeï¼‰ã€‚ã€Œã«ã€ä¹Ÿå¯ä»¥ã€‚", img: "ğŸ«" },
                { s: "å›³æ›¸é¤¨__å‹‰å¼·ã—ã¾ã™ã€‚", ans: "ã§", opts: ["ã«", "ã§", "ã‚’"], tip: "åœ¨æŸåœ°åšæŸäº‹ï¼ˆåŠ¨ä½œåœºæ‰€ï¼‰ï¼Œç”¨ã€Œã§ã€ã€‚", img: "ğŸ“š" },
                { s: "6æ™‚__èµ·ãã¾ã™ã€‚", ans: "ã«", opts: ["ã§", "ã«", "ã‚’"], tip: "å…·ä½“çš„æ—¶é—´ç‚¹åé¢æ¥ã€Œã«ã€ã€‚", img: "â°" },
                { s: "ãƒã‚¹__æ¥ã¾ã—ãŸã€‚", ans: "ã§", opts: ["ã«", "ã§", "ã¨"], tip: "è¡¨ç¤ºäº¤é€šå·¥å…·/æ‰‹æ®µï¼Œç”¨ã€Œã§ã€ã€‚", img: "ğŸšŒ" },
                { s: "éƒ¨å±‹__æœºãŒã‚ã‚Šã¾ã™ã€‚", ans: "ã«", opts: ["ã§", "ã«", "ã¸"], tip: "å­˜åœ¨å¥ä¸­ï¼Œå­˜åœ¨çš„åœ°ç‚¹ç”¨ã€Œã«ã€ã€‚", img: "ğŸª‘" }
            ]
        },
        {
            id: 3, title: "é«˜é˜¶ï¼šç»¼åˆæŒ‘æˆ˜", desc: "æ··åˆè€ƒå¯Ÿï¼ŒåŒ…å«æˆå—ä¸æ¯”è¾ƒ",
            questions: [
                { s: "æ¯__ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’ã‚ã’ã¾ã™ã€‚", ans: "ã«", opts: ["ã«", "ã¯", "ã‹ã‚‰"], tip: "ç»™æŸäººæŸç‰©ï¼Œæ¥å—è€…ç”¨ã€Œã«ã€ã€‚", img: "ğŸ" },
                { s: "æ—¥æœ¬__ä¸­å›½ã‚ˆã‚Šç‹­ã„ã§ã™ã€‚", ans: "ã¯", opts: ["ã¯", "ã‚ˆã‚Š", "ã®"], tip: "Aã¯Bã‚ˆã‚Š... Aæ¯”Bæ›´...", img: "ğŸ—ºï¸" },
                { s: "å…ˆç”Ÿ__ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚", ans: "ã«", opts: ["ã«", "ã‚’", "ã§"], tip: "ä»æŸäººé‚£é‡Œå¾—åˆ°ï¼Œæ¥æºå¯ä»¥ç”¨ã€Œã«ã€æˆ–ã€Œã‹ã‚‰ã€ã€‚", img: "ğŸ“œ" },
                { s: "æ—¥æ›œæ—¥__ä¼‘ã¿ãŸã„ã§ã™ã€‚", ans: "ã¯", opts: ["ã¯", "ã‚’", "ã«"], tip: "è¿™é‡Œå¼ºè°ƒå‘¨æ—¥è¿™ä¸€å¤©ï¼Œç”¨ã€Œã¯ã€å¯¹æ¯”æˆ–å¼ºè°ƒã€‚", img: "ğŸ“…" },
                { s: "ä¸€äºº__è¡Œãã¾ã™ã€‚", ans: "ã§", opts: ["ã§", "ã«", "ã‚’"], tip: "è¡¨ç¤ºçŠ¶æ€/æ•°é‡èŒƒå›´ï¼ˆä¸€ä¸ªäººå»ï¼‰ï¼Œç”¨ã€Œã§ã€ã€‚", img: "ğŸš¶" }
            ]
        }
    ];

    // === æ¸¸æˆçŠ¶æ€ ===
    let currentLevelIdx = 0;
    let currentQIdx = 0;
    let score = 0;
    let mistakes = [];
    let unlockedLevels = 1; // é»˜è®¤è§£é”ç¬¬ä¸€å…³

    // === åˆå§‹åŒ– ===
    function init() {
        renderMenu();
    }

    function renderMenu() {
        const menu = document.getElementById('level-menu');
        menu.innerHTML = '';
        document.getElementById('game-area').style.display = 'none';
        document.getElementById('result-area').style.display = 'none';
        document.getElementById('level-menu').style.display = 'grid';
        document.getElementById('page-title').innerText = "åŠ©è¯ç‰¹è®­è¥";
        document.getElementById('progress-display').innerText = "é€‰æ‹©å…³å¡å¼€å§‹æŒ‘æˆ˜";

        gameData.forEach((level, idx) => {
            const card = document.createElement('div');
            card.className = `level-card ${idx + 1 > unlockedLevels ? 'locked' : ''}`;
            card.innerHTML = `
                <div class="level-title">Lv.${level.id} ${level.title}</div>
                <div class="level-desc">${level.desc}</div>
                ${idx + 1 > unlockedLevels ? 'ğŸ”’' : 'â–¶ï¸'}
            `;
            card.onclick = () => startLevel(idx);
            menu.appendChild(card);
        });
    }

    function startLevel(idx) {
        currentLevelIdx = idx;
        currentQIdx = 0;
        score = 0;
        mistakes = [];
        
        document.getElementById('level-menu').style.display = 'none';
        document.getElementById('result-area').style.display = 'none';
        document.getElementById('game-area').style.display = 'flex';
        
        loadQuestion();
    }

    function loadQuestion() {
        const level = gameData[currentLevelIdx];
        const q = level.questions[currentQIdx];
        
        document.getElementById('page-title').innerText = level.title;
        document.getElementById('progress-display').innerText = `è¿›åº¦: ${currentQIdx + 1} / ${level.questions.length}`;
        document.getElementById('scene-emoji').innerText = q.img;
        
        // æ¸²æŸ“å¥å­
        const parts = q.s.split('__');
        document.getElementById('sentence-display').innerHTML = 
            `${parts[0]}<span class="blank">?</span>${parts[1]}`;
            
        // æ¸²æŸ“é€‰é¡¹
        const optsContainer = document.getElementById('options-container');
        optsContainer.innerHTML = '';
        // æ‰“ä¹±é€‰é¡¹
        const shuffledOpts = [...q.opts].sort(() => Math.random() - 0.5);
        
        shuffledOpts.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(btn, opt, q);
            optsContainer.appendChild(btn);
        });

        // éšè—åé¦ˆ
        document.getElementById('feedback-box').style.display = 'none';
    }

    function checkAnswer(btn, selected, q) {
        // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        const isCorrect = selected === q.ans;
        const fbBox = document.getElementById('feedback-box');
        const fbTitle = document.getElementById('fb-title');
        const fbDesc = document.getElementById('fb-desc');

        if (isCorrect) {
            score++;
            btn.classList.add('correct');
            fbTitle.innerText = "ğŸ‰ æ­£è§£ï¼";
            fbTitle.style.color = "#27ae60";
            fbDesc.innerText = q.tip;
            
            // å¡«å…¥æ­£ç¡®ç­”æ¡ˆå¹¶æœ—è¯»
            document.querySelector('.blank').innerText = selected;
            speak(q.s.replace('__', selected));
        } else {
            btn.classList.add('wrong');
            // æ‰¾åˆ°æ­£ç¡®æŒ‰é’®é«˜äº®
            allBtns.forEach(b => {
                if(b.innerText === q.ans) b.classList.add('correct');
            });
            
            fbTitle.innerText = "âŒ é—æ†¾...";
            fbTitle.style.color = "#c0392b";
            fbDesc.innerText = `æ­£ç¡®ç­”æ¡ˆæ˜¯ã€Œ${q.ans}ã€ã€‚${q.tip}`;
            
            // è®°å½•é”™é¢˜
            mistakes.push(q);
        }

        fbBox.style.display = 'block';
    }

    function nextQuestion() {
        currentQIdx++;
        if (currentQIdx < gameData[currentLevelIdx].questions.length) {
            loadQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        document.getElementById('game-area').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        
        const total = gameData[currentLevelIdx].questions.length;
        const percent = Math.round((score / total) * 100);
        
        document.getElementById('final-score').innerText = percent + "%";
        
        const msg = document.getElementById('result-msg');
        if (percent >= 80) {
            msg.innerText = "ğŸ‰ æ­å–œé€šå…³ï¼ä¸‹ä¸€å…³å·²è§£é”";
            msg.style.color = "#27ae60";
            if (currentLevelIdx + 1 >= unlockedLevels) {
                unlockedLevels++;
            }
        } else {
            msg.innerText = "ğŸ’ª åŠ æ²¹ï¼Œè¾¾åˆ°80%æ‰èƒ½è§£é”ä¸‹ä¸€å…³";
            msg.style.color = "#e67e22";
        }

        // æ¸²æŸ“é”™é¢˜æœ¬
        const mistakeBox = document.getElementById('mistake-box');
        const mistakeItems = document.getElementById('mistake-items');
        mistakeItems.innerHTML = '';
        
        if (mistakes.length > 0) {
            mistakeBox.style.display = 'block';
            mistakes.forEach(m => {
                const div = document.createElement('div');
                div.className = 'mistake-item';
                div.innerHTML = `
                    <div style="font-weight:bold;">${m.s.replace('__', ' ( ? ) ')}</div>
                    <div style="color:#27ae60; font-size:0.9rem;">æ­£è§£ï¼š${m.ans}</div>
                    <div style="color:#7f8c8d; font-size:0.8rem;">${m.tip}</div>
                `;
                mistakeItems.appendChild(div);
            });
        } else {
            mistakeBox.style.display = 'none';
        }
    }

    function retryLevel() {
        startLevel(currentLevelIdx);
    }

    function showMenu() {
        renderMenu();
    }

    function speak(text) {
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ja-JP';
        window.speechSynthesis.speak(u);
    }

    init();
</script>
</body>
</html>
