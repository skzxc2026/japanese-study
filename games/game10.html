<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŠ¨è¯åˆ†ç±»å·¥å‚</title>
    <style>
        :root {
            --g1-color: #4facfe; /* ä¸€ç±» - è“ */
            --g2-color: #f6d365; /* äºŒç±» - é»„ */
            --g3-color: #ff9a9e; /* ä¸‰ç±» - ç²‰ */
            --bg-color: #f0f4f8;
            --text-color: #2d3436;
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--bg-color);
            font-family: "Microsoft YaHei", sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* é¡¶éƒ¨æ  */
        .header {
            background: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            z-index: 10;
            flex-shrink: 0;
        }
        .score-board { font-size: 1rem; font-weight: bold; color: #555; }
        .score-val { color: #00b894; font-size: 1.3rem; margin-left: 5px; }

        /* æ¸¸æˆä¸»åŒºåŸŸ */
        #game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }

        /* åˆ†ç±»ç›’å­åŒºåŸŸ - é«˜åº¦å›ºå®šï¼Œé˜²æ­¢è¢«æ’‘å¼€ */
        .drop-zones {
            display: flex;
            gap: 8px;
            height: 40%; /* å æ®ä¸Šæ–¹ç©ºé—´ */
            min-height: 200px;
        }

        .zone {
            flex: 1;
            border-radius: 12px;
            border: 2px dashed rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column; /* æ ‡é¢˜åœ¨é¡¶ï¼Œå†…å®¹åœ¨ä¸‹ */
            align-items: center;
            padding: 5px;
            transition: all 0.3s;
            position: relative;
            background: rgba(255,255,255,0.6);
            overflow: hidden;
        }

        /* ç›’å­æ ‡é¢˜ */
        .zone-header {
            width: 100%;
            text-align: center;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            margin-bottom: 5px;
            flex-shrink: 0;
        }
        .zone h3 { margin: 5px 0 2px 0; font-size: 0.9rem; }
        .zone .desc { font-size: 0.65rem; color: #666; display: block; }

        /* ç›’å­å†…å®¹åŒº - å…è®¸æ»šåŠ¨ï¼Œä½¿ç”¨ Flex Wrap è®©æ ‡ç­¾ç´§å‡‘æ’åˆ— */
        .zone-content {
            flex: 1;
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start; /* å†…å®¹ä»ä¸Šå¾€ä¸‹å †å  */
            justify-content: center;
            gap: 4px;
            overflow-y: auto; /* å†…å®¹å¤šäº†å¯ä»¥æ»š */
        }
        
        /* ç›’å­é¢œè‰²ä¸»é¢˜ */
        .zone[data-type="1"] { background: #e3f2fd; border-color: var(--g1-color); }
        .zone[data-type="1"] h3 { color: #1565c0; }
        
        .zone[data-type="2"] { background: #fffde7; border-color: var(--g2-color); }
        .zone[data-type="2"] h3 { color: #fbc02d; }
        
        .zone[data-type="3"] { background: #ffebee; border-color: var(--g3-color); }
        .zone[data-type="3"] h3 { color: #c62828; }

        .zone.drag-over { transform: scale(1.02); background: white; border-style: solid; box-shadow: 0 0 15px rgba(0,0,0,0.1); }

        /* å¾…åˆ†ç±»å¡ç‰‡åŒºåŸŸ */
        #card-pool {
            flex: 1;
            background: white;
            border-radius: 15px 15px 0 0;
            padding: 20px 10px;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            justify-content: center;
            gap: 12px;
            overflow-y: auto;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
        }

        /* === åŸå§‹å¤§å¡ç‰‡æ ·å¼ === */
        .card {
            background: white;
            padding: 12px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 0 #e0e0e0; /* 3DæŒ‰é’®æ„Ÿ */
            border: 1px solid #eee;
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--text-color);
            cursor: grab;
            touch-action: none;
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }
        .card:active { box-shadow: none; transform: translateY(4px); }
        .card span.sub { font-size: 0.75rem; color: #999; margin-top: 2px; font-weight: normal; }

        /* === æ‹–æ‹½æ—¶çš„æ ·å¼ (å…‹éš†ä½“) === */
        .card.dragging-clone {
            position: fixed;
            z-index: 999;
            opacity: 0.9;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            transform: scale(1.1) rotate(-3deg);
            pointer-events: none;
            background: #fff;
        }

        /* === æ”¾å…¥ç›’å­åçš„è¿·ä½ èƒ¶å›Šæ ·å¼ (å…³é”®ä¿®æ”¹) === */
        .mini-tag {
            background: rgba(255,255,255,0.8);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: bold;
            color: #333;
            border: 1px solid rgba(0,0,0,0.1);
            display: inline-flex;
            align-items: center;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            cursor: default;
        }
        /* æ ¹æ®åˆ†ç±»ç»™æ ‡ç­¾æ–‡å­—ä¸Šè‰² */
        .zone[data-type="1"] .mini-tag { color: #1565c0; }
        .zone[data-type="2"] .mini-tag { color: #f9a825; }
        .zone[data-type="3"] .mini-tag { color: #c62828; }

        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        /* é®ç½©å±‚ */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.98);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 30px;
        }
        .btn {
            background: var(--g1-color); color: white; border: none; padding: 15px 50px;
            font-size: 1.2rem; border-radius: 50px; cursor: pointer;
            margin-top: 30px; box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
            font-weight: bold;
        }

        /* æ‰‹æœºé€‚é… */
        @media (max-width: 600px) {
            .drop-zones { flex-direction: column; height: 55%; gap: 5px; }
            .zone { flex-direction: row; align-items: center; padding: 0 10px; }
            .zone-header { width: auto; border-bottom: none; margin: 0; padding: 0; text-align: left; margin-right: 10px; min-width: 70px; }
            .zone h3 { font-size: 0.85rem; }
            .zone .desc { display: none; } /* æ‰‹æœºéšè—æè¿° */
            .zone-content { justify-content: flex-start; align-items: center; flex-wrap: nowrap; overflow-x: auto; overflow-y: hidden; }
            .mini-tag { font-size: 0.8rem; white-space: nowrap; flex-shrink: 0; }
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="score-board">è¿›åº¦ <span id="progress" class="score-val">0/20</span></div>
        <div class="score-board">å¾—åˆ† <span id="score" class="score-val">0</span></div>
    </div>

    <div id="game-area">
        <!-- åˆ†ç±»ç›’å­ -->
        <div class="drop-zones">
            <div class="zone" data-type="1">
                <div class="zone-header">
                    <h3>ä¸€ç±»åŠ¨è¯</h3>
                    <span class="desc">äº”æ®µ / ã†æ®µ</span>
                </div>
                <div class="zone-content"></div>
            </div>
            <div class="zone" data-type="2">
                <div class="zone-header">
                    <h3>äºŒç±»åŠ¨è¯</h3>
                    <span class="desc">ä¸€æ®µ / ã„ã‚‹ãƒ»ãˆã‚‹</span>
                </div>
                <div class="zone-content"></div>
            </div>
            <div class="zone" data-type="3">
                <div class="zone-header">
                    <h3>ä¸‰ç±»åŠ¨è¯</h3>
                    <span class="desc">ã™ã‚‹ / ãã‚‹</span>
                </div>
                <div class="zone-content"></div>
            </div>
        </div>

        <!-- å¡ç‰‡æ±  -->
        <div id="card-pool"></div>
    </div>

    <!-- é®ç½© -->
    <div id="overlay">
        <h1 style="color:#333; margin-bottom:10px">ğŸ­ åŠ¨è¯åˆ†ç±»å·¥å‚</h1>
        <p style="color:#777;">æ‹–æ‹½å¡ç‰‡åˆ°æ­£ç¡®çš„åˆ†ç±»æ¡†<br>å®Œæˆåå¡ç‰‡ä¼šå˜æˆå°æ ‡ç­¾</p>
        <button class="btn" onclick="startGame()">å¼€å§‹ä¸Šç­</button>
    </div>

<script>
    // === æ•°æ® ===
    const VERB_DB = [
        { w: "è¡Œã", k: "ã„ã", t: 1 }, { w: "é£²ã‚€", k: "ã®ã‚€", t: 1 }, 
        { w: "èª­ã‚€", k: "ã‚ˆã‚€", t: 1 }, { w: "éŠã¶", k: "ã‚ãã¶", t: 1 },
        { w: "å¾…ã¤", k: "ã¾ã¤", t: 1 }, { w: "è²·ã†", k: "ã‹ã†", t: 1 },
        { w: "è©±ã™", k: "ã¯ãªã™", t: 1 }, { w: "æ³³ã", k: "ãŠã‚ˆã", t: 1 },
        // é™·é˜±
        { w: "å¸°ã‚‹", k: "ã‹ãˆã‚‹", t: 1 }, { w: "åˆ‡ã‚‹", k: "ãã‚‹", t: 1 },
        { w: "çŸ¥ã‚‹", k: "ã—ã‚‹", t: 1 }, { w: "å…¥ã‚‹", k: "ã¯ã„ã‚‹", t: 1 },
        { w: "èµ°ã‚‹", k: "ã¯ã—ã‚‹", t: 1 },
        // äºŒç±»
        { w: "é£Ÿã¹ã‚‹", k: "ãŸã¹ã‚‹", t: 2 }, { w: "è¦‹ã‚‹", k: "ã¿ã‚‹", t: 2 },
        { w: "å¯ã‚‹", k: "ã­ã‚‹", t: 2 }, { w: "èµ·ãã‚‹", k: "ãŠãã‚‹", t: 2 },
        { w: "æ•™ãˆã‚‹", k: "ãŠã—ãˆã‚‹", t: 2 }, { w: "å€Ÿã‚Šã‚‹", k: "ã‹ã‚Šã‚‹", t: 2 },
        { w: "è€ƒãˆã‚‹", k: "ã‹ã‚“ãŒãˆã‚‹", t: 2 }, { w: "ç€ã‚‹", k: "ãã‚‹", t: 2 },
        // ä¸‰ç±»
        { w: "ã™ã‚‹", k: "ã™ã‚‹", t: 3 }, { w: "æ¥ã‚‹", k: "ãã‚‹", t: 3 },
        { w: "å‹‰å¼·ã™ã‚‹", k: "ã¹ã‚“ãã‚‡ã†", t: 3 }, { w: "æ•£æ­©ã™ã‚‹", k: "ã•ã‚“ã½", t: 3 }
    ];

    // === éŸ³æ•ˆ ===
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;

        if (type === 'pop') {
            osc.frequency.setValueAtTime(600, now);
            gain.gain.setValueAtTime(0.1, now);
            osc.start(now); osc.stop(now + 0.1);
        } else if (type === 'correct') {
            osc.frequency.setValueAtTime(800, now);
            osc.frequency.linearRampToValueAtTime(1200, now + 0.1);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.3);
            osc.start(now); osc.stop(now + 0.3);
        } else if (type === 'wrong') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.linearRampToValueAtTime(100, now + 0.2);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.2);
            osc.start(now); osc.stop(now + 0.2);
        }
    }

    // === æ¸¸æˆé€»è¾‘ ===
    let score = 0;
    let completedCount = 0;
    const TOTAL_CARDS = 20;

    function startGame() {
        document.getElementById('overlay').style.display = 'none';
        if (audioCtx.state === 'suspended') audioCtx.resume();
        score = 0;
        completedCount = 0;
        updateUI();
        
        // æ¸…ç©ºæ—§æ•°æ®
        document.querySelectorAll('.zone-content').forEach(el => el.innerHTML = '');
        const pool = document.getElementById('card-pool');
        pool.innerHTML = '';

        // ç”Ÿæˆå¡ç‰‡
        const shuffled = [...VERB_DB].sort(() => Math.random() - 0.5).slice(0, TOTAL_CARDS);
        shuffled.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `${item.w}<span class="sub">${item.k}</span>`;
            card.dataset.type = item.t;
            card.dataset.word = item.w; // å­˜ä¸€ä¸‹çº¯æ–‡æœ¬
            initDraggable(card);
            pool.appendChild(card);
        });
    }

    function updateUI() {
        document.getElementById('score').innerText = score;
        document.getElementById('progress').innerText = `${completedCount}/${TOTAL_CARDS}`;
    }

    // === æ‹–æ‹½é€»è¾‘ ===
    let activeCard = null;
    let cloneCard = null;
    let startX, startY;

    function initDraggable(card) {
        card.addEventListener('mousedown', onStart);
        card.addEventListener('touchstart', onStart, { passive: false });
    }

    function onStart(e) {
        e.preventDefault();
        playSound('pop');
        
        activeCard = e.currentTarget;
        const point = e.touches ? e.touches[0] : e;
        startX = point.clientX;
        startY = point.clientY;

        // 1. åˆ›å»ºå…‹éš†ä½“ (ç”¨äºè·Ÿéšæ‰‹æŒ‡)
        cloneCard = activeCard.cloneNode(true);
        cloneCard.classList.add('dragging-clone');
        
        // è®¾ç½®å…‹éš†ä½“åˆå§‹ä½ç½®
        const rect = activeCard.getBoundingClientRect();
        cloneCard.style.width = rect.width + 'px';
        cloneCard.style.height = rect.height + 'px';
        cloneCard.style.left = rect.left + 'px';
        cloneCard.style.top = rect.top + 'px';
        document.body.appendChild(cloneCard);

        // 2. éšè—åŸå¡ç‰‡ (å…³é”®ä¿®æ”¹ï¼šå®Œå…¨é€æ˜ï¼Œè§£å†³â€œé®æŒ¡â€é—®é¢˜)
        activeCard.style.opacity = '0';

        // ç»‘å®šç§»åŠ¨äº‹ä»¶
        document.addEventListener('mousemove', onMove);
        document.addEventListener('touchmove', onMove, { passive: false });
        document.addEventListener('mouseup', onEnd);
        document.addEventListener('touchend', onEnd);
    }

    function onMove(e) {
        if (!cloneCard) return;
        e.preventDefault();
        const point = e.touches ? e.touches[0] : e;
        const dx = point.clientX - startX;
        const dy = point.clientY - startY;

        // ç§»åŠ¨å…‹éš†ä½“
        cloneCard.style.transform = `translate(${dx}px, ${dy}px) rotate(-5deg) scale(1.1)`;
        
        // é«˜äº®æ£€æµ‹
        checkHover(point.clientX, point.clientY);
    }

    function onEnd(e) {
        if (!cloneCard) return;

        // è·å–æ”¾ç½®ç‚¹
        const rect = cloneCard.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        const targetZone = getDropTarget(centerX, centerY);

        if (targetZone) {
            handleDrop(targetZone);
        } else {
            // æ²¡æ”¾è¿›ç›’å­ï¼ŒåŸå¡ç‰‡æ¢å¤æ˜¾ç¤º
            activeCard.style.opacity = '1';
            playSound('wrong');
        }

        // æ¸…ç†
        cloneCard.remove();
        cloneCard = null;
        activeCard = null;
        document.querySelectorAll('.zone').forEach(z => z.classList.remove('drag-over'));
        
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('touchmove', onMove);
        document.removeEventListener('mouseup', onEnd);
        document.removeEventListener('touchend', onEnd);
    }

    function checkHover(x, y) {
        document.querySelectorAll('.zone').forEach(zone => {
            const rect = zone.getBoundingClientRect();
            if (x > rect.left && x < rect.right && y > rect.top && y < rect.bottom) {
                zone.classList.add('drag-over');
            } else {
                zone.classList.remove('drag-over');
            }
        });
    }

    function getDropTarget(x, y) {
        let target = null;
        document.querySelectorAll('.zone').forEach(zone => {
            const rect = zone.getBoundingClientRect();
            if (x > rect.left && x < rect.right && y > rect.top && y < rect.bottom) {
                target = zone;
            }
        });
        return target;
    }

    function handleDrop(zone) {
        const cardType = parseInt(activeCard.dataset.type);
        const zoneType = parseInt(zone.dataset.type);

        if (cardType === zoneType) {
            // === æ­£ç¡®ï¼šå˜èº«å°æ ‡ç­¾ ===
            playSound('correct');
            score += 10;
            completedCount++;
            
            // 1. åˆ›å»ºè¿·ä½ æ ‡ç­¾ (å…³é”®ä¿®æ”¹ï¼šåªæ˜¾ç¤ºæ±‰å­—ï¼Œä½“ç§¯å¾ˆå°)
            const miniTag = document.createElement('div');
            miniTag.className = 'mini-tag';
            miniTag.textContent = activeCard.dataset.word; // åªå–æ±‰å­—
            
            // 2. æ”¾å…¥ç›’å­çš„å†…å®¹åŒº
            zone.querySelector('.zone-content').appendChild(miniTag);
            
            // 3. å½»åº•ç§»é™¤åŸå¡ç‰‡
            activeCard.remove();
            
            checkWin();
        } else {
            // === é”™è¯¯ ===
            playSound('wrong');
            score = Math.max(0, score - 5);
            activeCard.style.opacity = '1'; // æ¢å¤æ˜¾ç¤º
            // ç®€å•éœ‡åŠ¨åé¦ˆ
            activeCard.style.transition = 'transform 0.1s';
            activeCard.style.transform = 'translateX(10px)';
            setTimeout(() => activeCard.style.transform = 'translateX(-10px)', 100);
            setTimeout(() => activeCard.style.transform = 'none', 200);
        }
        updateUI();
    }

    function checkWin() {
        if (completedCount >= TOTAL_CARDS) {
            setTimeout(() => {
                document.querySelector('#overlay h1').textContent = "ğŸ‰ å®Œç¾åˆ†ç±»ï¼";
                document.querySelector('#overlay p').innerHTML = `æœ€ç»ˆå¾—åˆ†: <b style="color:#00b894;font-size:1.5rem">${score}</b>`;
                document.querySelector('.btn').textContent = "å†æ¥ä¸€å±€";
                document.getElementById('overlay').style.display = 'flex';
            }, 500);
        }
    }
</script>
</body>
</html>
