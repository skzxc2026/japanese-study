<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å½¢å®¹è¯åˆ†ç±»å±‹</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap');

        body {
            margin: 0;
            font-family: "M PLUS Rounded 1c", "Microsoft YaHei", sans-serif;
            background: #fdfbfb;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            touch-action: none;
        }

        /* é¡¶éƒ¨åŒºåŸŸ */
        .header {
            padding: 10px 20px;
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
            z-index: 10;
        }
        .status-badge {
            background: #FF9800; color: white; padding: 5px 15px;
            border-radius: 20px; font-weight: bold; font-size: 0.9rem;
        }

        /* æˆ¿å­åŒºåŸŸ */
        #houses-area {
            height: 40%;
            background: #e0f7fa;
            border-bottom: 5px solid #81d4fa;
            display: flex; justify-content: space-around; align-items: flex-end;
            padding-bottom: 15px;
            position: relative;
        }

        .house {
            width: 40%; height: 75%;
            background: #fff;
            border: 3px solid #546E7A;
            border-radius: 0 0 10px 10px;
            position: relative;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: transform 0.2s;
        }
        .house.hover { transform: scale(1.05); background: #fffde7; }

        /* å±‹é¡¶ */
        .roof {
            position: absolute; top: -50px; left: -10%; width: 120%; height: 50px;
            background: #FF7043;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }
        #house-na .roof { background: #26A69A; }

        .house-label { font-size: 1.2rem; font-weight: bold; color: #37474F; margin-top: 5px; }
        .house-desc { font-size: 0.8rem; color: #78909C; }

        /* æ¡Œé¢åŒºåŸŸ (å¡ç‰‡æ± ) */
        #desk-area {
            flex: 1;
            background: #D7CCC8; /* æœ¨çº¹è‰² */
            background-image: repeating-linear-gradient(45deg, #D7CCC8 25%, #cfb9b0 25%, #cfb9b0 50%, #D7CCC8 50%, #D7CCC8 75%, #cfb9b0 75%, #cfb9b0 100%);
            background-size: 20px 20px;
            padding: 20px;
            overflow-y: auto; /* å…è®¸æ»šåŠ¨ */
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            justify-content: center;
            gap: 10px;
            position: relative;
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.1);
        }

        /* å•è¯å¡ç‰‡ */
        .card {
            background: white;
            border: 2px solid #8D6E63;
            border-radius: 8px;
            padding: 8px 12px;
            text-align: center;
            cursor: grab;
            box-shadow: 0 4px 0 #8D6E63, 0 5px 10px rgba(0,0,0,0.1);
            user-select: none;
            touch-action: none;
            transition: transform 0.1s;
            min-width: 80px;
            background-color: #FFF8E1;
        }
        .card:active { cursor: grabbing; transform: scale(0.95); }
        .card-ruby { font-size: 0.7rem; color: #E65100; display: block; margin-bottom: 2px; }
        .card-word { font-size: 1.1rem; font-weight: bold; color: #3E2723; }

        /* ç»“ç®—å¼¹çª— */
        #result-modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; color: white;
        }
        .btn {
            background: #FF9800; color: white; border: none; padding: 12px 30px;
            font-size: 1.1rem; border-radius: 30px; margin-top: 20px; cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-weight:bold; color:#5D4037;">ğŸ  æ•´ç†æˆ¿é—´</div>
        <div class="status-badge" id="count-display">å‰©ä½™: 20</div>
    </div>

    <div id="houses-area">
        <!-- ä¸€ç±» -->
        <div class="house" id="house-i">
            <div class="roof"></div>
            <div class="house-label">ã„å½¢å®¹è¯</div>
            <div class="house-desc">è¯å°¾æ˜¯ã€Œã„ã€</div>
        </div>
        <!-- äºŒç±» -->
        <div class="house" id="house-na">
            <div class="roof"></div>
            <div class="house-label">ãªå½¢å®¹è¯</div>
            <div class="house-desc">è¯å°¾éã€Œã„ã€</div>
        </div>
    </div>

    <div id="desk-area">
        <!-- å¡ç‰‡å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
    </div>

    <div id="result-modal">
        <h1>ğŸ‰ æ•´ç†å®Œæˆï¼</h1>
        <p>æˆ¿é—´å˜å¾—å¹²å¹²å‡€å‡€</p>
        <button class="btn" onclick="location.reload()">å†æ¥ä¸€å±€</button>
    </div>

<script>
    // === éŸ³æ•ˆç³»ç»Ÿ ===
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;

        if (type === 'ding') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, now);
            osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.3);
            osc.start(now); osc.stop(now + 0.3);
        } else if (type === 'buzz') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.linearRampToValueAtTime(100, now + 0.2);
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.3);
            osc.start(now); osc.stop(now + 0.3);
        }
    }

    // === é¢˜åº“ (æ±‰å­—+å‡å+ç±»å‹) ===
    const wordDB = [
        {w:"é«˜ã„", r:"ãŸã‹ã„", t:"i"}, {w:"é™ã‹", r:"ã—ãšã‹", t:"na"},
        {w:"æš‘ã„", r:"ã‚ã¤ã„", t:"i"}, {w:"æœ‰å", r:"ã‚†ã†ã‚ã„", t:"na"},
        {w:"å¤§ãã„", r:"ãŠãŠãã„", t:"i"}, {w:"è¦ªåˆ‡", r:"ã—ã‚“ã›ã¤", t:"na"},
        {w:"ç¾å‘³ã—ã„", r:"ãŠã„ã—ã„", t:"i"}, {w:"ä¾¿åˆ©", r:"ã¹ã‚“ã‚Š", t:"na"},
        {w:"å¿™ã—ã„", r:"ã„ããŒã—ã„", t:"i"}, {w:"ãã‚Œã„", r:"ãã‚Œã„", t:"na"}, // é™·é˜±
        {w:"å«Œã„", r:"ãã‚‰ã„", t:"na"}, {w:"é¢ç™½ã„", r:"ãŠã‚‚ã—ã‚ã„", t:"i"}, // é™·é˜±
        {w:"å¯’ã„", r:"ã•ã‚€ã„", t:"i"}, {w:"å…ƒæ°—", r:"ã’ã‚“ã", t:"na"},
        {w:"æ–°ã—ã„", r:"ã‚ãŸã‚‰ã—ã„", t:"i"}, {w:"æš‡", r:"ã²ã¾", t:"na"},
        {w:"èµ¤ã„", r:"ã‚ã‹ã„", t:"i"}, {w:"ç°¡å˜", r:"ã‹ã‚“ãŸã‚“", t:"na"},
        {w:"é›£ã—ã„", r:"ã‚€ãšã‹ã—ã„", t:"i"}, {w:"ç«‹æ´¾", r:"ã‚Šã£ã±", t:"na"},
        {w:"ç”˜ã„", r:"ã‚ã¾ã„", t:"i"}, {w:"å¥½ã", r:"ã™ã", t:"na"},
        {w:"åºƒã„", r:"ã²ã‚ã„", t:"i"}, {w:"ä¸ˆå¤«", r:"ã˜ã‚‡ã†ã¶", t:"na"},
        {w:"æ¥½ã—ã„", r:"ãŸã®ã—ã„", t:"i"}, {w:"å¤§å¤‰", r:"ãŸã„ã¸ã‚“", t:"na"}
    ];

    let remaining = 0;

    function init() {
        // éšæœºé€‰20ä¸ª
        const shuffled = [...wordDB].sort(() => Math.random() - 0.5).slice(0, 20);
        remaining = shuffled.length;
        updateCount();

        const desk = document.getElementById('desk-area');
        desk.innerHTML = '';

        shuffled.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.type = item.t;
            card.innerHTML = `<span class="card-ruby">${item.r}</span><span class="card-word">${item.w}</span>`;
            
            // éšæœºå¾®å°æ—‹è½¬ï¼Œå¢åŠ è‡ªç„¶æ„Ÿ
            const rot = (Math.random() - 0.5) * 10;
            card.style.transform = `rotate(${rot}deg)`;
            
            desk.appendChild(card);
            makeDraggable(card);
        });
    }

    function updateCount() {
        document.getElementById('count-display').innerText = `å‰©ä½™: ${remaining}`;
        if (remaining === 0) {
            setTimeout(() => {
                document.getElementById('result-modal').style.display = 'flex';
            }, 500);
        }
    }

    // === æ‹–æ‹½é€»è¾‘ ===
    let startX, startY, initialLeft, initialTop;
    let activeCard = null;

    function makeDraggable(el) {
        const start = (e) => {
            e.preventDefault();
            const touch = e.touches ? e.touches[0] : e;
            activeCard = el;
            startX = touch.clientX;
            startY = touch.clientY;

            const rect = el.getBoundingClientRect();
            initialLeft = rect.left;
            initialTop = rect.top;

            // å˜ä¸ºFixedå®šä½ä»¥è„±ç¦»æ–‡æ¡£æµè¿›è¡Œæ‹–æ‹½
            el.style.position = 'fixed';
            el.style.left = initialLeft + 'px';
            el.style.top = initialTop + 'px';
            el.style.zIndex = 1000;
            el.style.transform = 'scale(1.1) rotate(0deg)';
            el.style.margin = 0; // æ¸…é™¤Flexå¸ƒå±€ä¸‹çš„marginå½±å“

            document.addEventListener('mousemove', move);
            document.addEventListener('touchmove', move, {passive: false});
            document.addEventListener('mouseup', end);
            document.addEventListener('touchend', end);
        };

        const move = (e) => {
            e.preventDefault();
            const touch = e.touches ? e.touches[0] : e;
            const dx = touch.clientX - startX;
            const dy = touch.clientY - startY;
            el.style.left = (initialLeft + dx) + 'px';
            el.style.top = (initialTop + dy) + 'px';
            
            // é«˜äº®æ£€æµ‹
            checkHover(el);
        };

        const end = (e) => {
            document.removeEventListener('mousemove', move);
            document.removeEventListener('touchmove', move);
            document.removeEventListener('mouseup', end);
            document.removeEventListener('touchend', end);
            
            // ç§»é™¤é«˜äº®
            document.querySelectorAll('.house').forEach(h => h.classList.remove('hover'));
            
            checkDrop(el);
            activeCard = null;
        };

        el.addEventListener('mousedown', start);
        el.addEventListener('touchstart', start, {passive: false});
    }

    function checkHover(card) {
        const rect = card.getBoundingClientRect();
        const center = { x: rect.left + rect.width/2, y: rect.top + rect.height/2 };
        
        const hI = document.getElementById('house-i').getBoundingClientRect();
        const hNa = document.getElementById('house-na').getBoundingClientRect();

        document.getElementById('house-i').classList.toggle('hover', isInside(center, hI));
        document.getElementById('house-na').classList.toggle('hover', isInside(center, hNa));
    }

    function checkDrop(card) {
        const rect = card.getBoundingClientRect();
        const center = { x: rect.left + rect.width/2, y: rect.top + rect.height/2 };
        
        const hI = document.getElementById('house-i').getBoundingClientRect();
        const hNa = document.getElementById('house-na').getBoundingClientRect();

        let target = null;
        if (isInside(center, hI)) target = 'i';
        else if (isInside(center, hNa)) target = 'na';

        if (target && target === card.dataset.type) {
            // æ­£ç¡®
            playSound('ding');
            card.style.transform = 'scale(0)';
            setTimeout(() => card.remove(), 200);
            remaining--;
            updateCount();
        } else {
            // é”™è¯¯æˆ–æœªæ”¾å…¥
            if (target) playSound('buzz'); // åªæœ‰æ”¾é”™æˆ¿å­æ‰å“ï¼Œæ²¡æ”¾è¿›å»ä¸å“
            returnToDesk(card);
        }
    }

    function returnToDesk(card) {
        // ç®€å•å¤ä½ï¼šå–æ¶ˆfixedï¼Œå˜å›åŸæ ·ï¼Œæ”¾å›deskå®¹å™¨
        card.style.transition = 'all 0.3s';
        card.style.position = 'static'; // æ¢å¤é™æ€æµ
        card.style.transform = `rotate(${(Math.random()-0.5)*10}deg)`;
        card.style.zIndex = 1;
    }

    function isInside(p, r) {
        return p.x >= r.left && p.x <= r.right && p.y >= r.top && p.y <= r.bottom;
    }

    init();
</script>
</body>
</html>
